# clow99/NexusDocs — Architecture

Generated by NexusDocs from a scan of the repository at ref `main`.

## Architecture

NexusDocs is a full-stack Next.js 16 application that:

- Connects to GitHub to scan repositories.
- Stores scan results, projects, and AI-generated documentation proposals in a MariaDB/MySQL database via Prisma.
- Uses OpenAI (or a mock generator) to propose documentation updates.
- Exposes a set of REST-like API routes under `/api` consumed by the Next.js app.

At a high level, the system consists of:

- **Web UI** (Next.js app router, React 19, Tailwind CSS, Radix UI).
- **API layer** (Next.js route handlers under `src/app/api`).
- **Persistence layer** (Prisma ORM with MariaDB/MySQL).
- **External integrations**:
  - GitHub OAuth + repository access.
  - OpenAI for AI-assisted documentation generation.

### Repository layout (top-level)

- `src/` (92 files)
- `docs/` (4 files)
- `.env.example/` (1 files)
- `.gitignore/` (1 files)
- `DATABASE_SETUP.md/` (1 files)
- `Dockerfile/` (1 files)
- `README.md/` (1 files)
- `default.conf/` (1 files)
- `docker-compose.yml/` (1 files)
- `eslint.config.js/` (1 files)
- `jsconfig.json/` (1 files)
- `next.config.js/` (1 files)
- `package-lock.json/` (1 files)

### Key directories

#### `src/`

Main application source, structured as a Next.js App Router project. Typical sub-areas include:

- `src/app/`
  - **Pages and layouts** for the UI (projects list, project detail, proposals, scans, settings, auth flows).
  - **API route handlers** under `src/app/api/**`, implementing the backend for:
    - **AI status**: `/api/ai/status` — checks whether OpenAI is configured.
    - **Authentication**:
      - NextAuth routes under `/api/auth/:...nextauth`.
      - GitHub OAuth connect/callback and PAT management under `/api/auth/github/**`.
      - User profile and “me” endpoints under `/api/auth/me` and `/api/auth/profile`.
    - **Projects**:
      - CRUD for projects under `/api/projects` and `/api/projects/:projectId`.
      - Project settings under `/api/projects/:projectId/settings`.
    - **Scanning & drift**:
      - Trigger scans and list scans under `/api/projects/:projectId/scan` and `/api/projects/:projectId/scans`.
      - Retrieve individual scans under `/api/projects/:projectId/scans/:scanId`.
      - Drift inspection under `/api/projects/:projectId/drift`.
      - Cron entrypoint for scheduled scans under `/api/cron/scans`.
    - **AI documentation proposals**:
      - Generate proposals under `/api/projects/:projectId/ai/generate`.
      - List and fetch proposals under `/api/projects/:projectId/proposals` and `/api/projects/:projectId/proposals/:proposalId`.
      - Approve, reject, publish, and regenerate proposals via the corresponding `/approve`, `/reject`, `/publish`, and `/regenerate` routes.

- **Client-side data fetching** is typically done with `@tanstack/react-query`, and forms are handled with `react-hook-form` and `zod` for validation.

- **Auth** is implemented with `next-auth` and `@auth/prisma-adapter`, backed by the Prisma `User` model.

- **AI integration** uses the `openai` SDK. The `/api/ai/status` route and `/api/projects/:projectId/ai/generate` route encapsulate AI configuration checks and generation logic (with support for a mock mode via `NEXT_PUBLIC_MOCK_MODE`).

#### `docs/`

Project documentation, including this architecture overview and other high-level docs. This directory is intended to be generated and maintained by NexusDocs itself, based on repository scans and AI proposals.

#### Database / Prisma

Prisma is used as the ORM, with MariaDB/MySQL as the backing store:

- The connection is configured via `DATABASE_URL`.
- `npx prisma db push` is used to sync the schema.

Key conceptual models (see Prisma schema for exact fields):

- **User**: Authentication and profile information (email, name, OAuth identities).
- **Project**: Represents a tracked repository and its configuration (e.g., GitHub repo details, documentation settings).
- **Proposal**: Represents an AI-generated documentation proposal, including status (draft, approved, rejected, published), summary, and associated files/paths.

These models underpin the `/api/projects/**`, `/api/projects/:projectId/proposals/**`, and auth-related endpoints.

### External integrations

- **GitHub**
  - OAuth-based authentication and repository access.
  - Endpoints under `/api/auth/github/**` manage connection, callback, and PAT handling.
  - Project scans use GitHub repository data to detect code changes and documentation drift.

- **OpenAI**
  - Used to generate and refine documentation proposals.
  - Must be configured server-side; the client checks readiness via `/api/ai/status`.
  - The OpenAI API key is kept server-side and must not be exposed to the client.

### Runtime and deployment

- **Next.js 16** app, built and served via:
  - `npm run dev` for development.
  - `npm run build` + `npm start` for production.
- **Database**: MariaDB/MySQL, typically provisioned via `docker-compose.yml` in local setups.
- **Containerization**: `Dockerfile` and `default.conf` support container-based deployment behind a reverse proxy.

### Notes

- Add deeper module-level docs for key directories (e.g. `src/`, `prisma/`, `docs/`).
- When extending the architecture, keep API contracts in sync with the `/api/**` route handlers and the Prisma schema.